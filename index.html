<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.6.1">
<title>BOP documentation</title>
<link rel="stylesheet" href="/bop/css/main.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css">
<link rel="stylesheet" href="./pygments-colorful.css">
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>BOP documentation</h1>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_common_interface">1. Common Interface</a>
<ul class="sectlevel2">
<li><a href="#_memory_management">1.1. memory management</a></li>
<li><a href="#_setters">1.2. setters</a></li>
<li><a href="#_getters">1.3. getters</a></li>
<li><a href="#_error_handling">1.4. Error handling</a></li>
<li><a href="#_convenient_tools">1.5. Convenient tools</a></li>
</ul>
</li>
<li><a href="#_serial_interface">2. serial interface</a>
<ul class="sectlevel2">
<li><a href="#_write">2.1. write</a></li>
<li><a href="#_read">2.2. read</a></li>
</ul>
</li>
<li><a href="#_mpi_interface">3. mpi interface</a>
<ul class="sectlevel2">
<li><a href="#_write_2">3.1. write</a></li>
<li><a href="#_read_2">3.2. read</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_common_interface">1. Common Interface</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_memory_management">1.1. memory management</h3>
<div class="paragraph">
<p>The <code>BopData</code> data structure is hidden from user and can be
allocated/deallocated using the following functions:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span></span><span class="tok-n">BopStatus</span> <span class="tok-nf">bop_ini</span><span class="tok-p">(</span><span class="tok-n">BopData</span> <span class="tok-o">**</span><span class="tok-n">d</span><span class="tok-p">);</span>  <i class="conum" data-value="1"></i><b>(1)</b>
<span class="tok-n">BopStatus</span> <span class="tok-nf">bop_alloc</span><span class="tok-p">(</span><span class="tok-n">BopData</span> <span class="tok-o">*</span><span class="tok-n">d</span><span class="tok-p">);</span> <i class="conum" data-value="2"></i><b>(2)</b>
<span class="tok-n">BopStatus</span> <span class="tok-nf">bop_fin</span><span class="tok-p">(</span><span class="tok-n">BopData</span> <span class="tok-o">*</span><span class="tok-n">d</span><span class="tok-p">);</span>   <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>allocate hidden structure <code>BopData</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>allocate space for the data based on the set variables <code>n</code>,
<code>nvars</code> and <code>type</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>deallocate the hidden structure and, if needed, the internal
buffer for data</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_setters">1.2. setters</h3>
<div class="paragraph">
<p>A description of the data can be set using the following functions:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span></span><span class="tok-n">BopStatus</span> <span class="tok-nf">bop_set_n</span><span class="tok-p">(</span><span class="tok-kt">long</span> <span class="tok-n">n</span><span class="tok-p">,</span> <span class="tok-n">BopData</span> <span class="tok-o">*</span><span class="tok-n">d</span><span class="tok-p">);</span>                     <i class="conum" data-value="1"></i><b>(1)</b>
<span class="tok-n">BopStatus</span> <span class="tok-nf">bop_set_vars</span><span class="tok-p">(</span><span class="tok-kt">int</span> <span class="tok-n">n</span><span class="tok-p">,</span> <span class="tok-k">const</span> <span class="tok-kt">char</span> <span class="tok-o">*</span><span class="tok-n">vars</span><span class="tok-p">,</span> <span class="tok-n">BopData</span> <span class="tok-o">*</span><span class="tok-n">d</span><span class="tok-p">);</span> <i class="conum" data-value="2"></i><b>(2)</b>
<span class="tok-n">BopStatus</span> <span class="tok-nf">bop_set_type</span><span class="tok-p">(</span><span class="tok-n">BopType</span> <span class="tok-n">type</span><span class="tok-p">,</span> <span class="tok-n">BopData</span> <span class="tok-o">*</span><span class="tok-n">d</span><span class="tok-p">);</span>            <i class="conum" data-value="3"></i><b>(3)</b>
<span class="tok-kt">void</span><span class="tok-o">*</span> <span class="tok-nf">bop_get_data</span><span class="tok-p">(</span><span class="tok-n">BopData</span> <span class="tok-o">*</span><span class="tok-n">d</span><span class="tok-p">);</span>                              <i class="conum" data-value="4"></i><b>(4)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>set the number of particles</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>set the number of variables and their names separated by space in a sigle string</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>set the type of the data</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>get a pointer of the internal data buffer (read, write)</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The type is defined in the enumeration type:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span></span><span class="tok-k">enum</span> <span class="tok-n">BopType</span> <span class="tok-p">{</span><span class="tok-n">BopFLOAT</span><span class="tok-p">,</span> <span class="tok-n">BopDOUBLE</span><span class="tok-p">,</span> <span class="tok-n">BopINT</span><span class="tok-p">,</span> <span class="tok-n">BopFASCII</span><span class="tok-p">,</span> <span class="tok-n">BopIASCII</span><span class="tok-p">};</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_getters">1.3. getters</h3>
<div class="paragraph">
<p>The informations stored in the <code>BopData</code> descriptor can be retrieved
by using the following getter functions:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span></span><span class="tok-n">BopStatus</span> <span class="tok-nf">bop_get_n</span><span class="tok-p">(</span><span class="tok-k">const</span> <span class="tok-n">BopData</span> <span class="tok-o">*</span><span class="tok-n">d</span><span class="tok-p">,</span> <span class="tok-kt">long</span> <span class="tok-o">*</span><span class="tok-n">n</span><span class="tok-p">);</span>              <i class="conum" data-value="1"></i><b>(1)</b>
<span class="tok-n">BopStatus</span> <span class="tok-nf">bop_get_nvars</span><span class="tok-p">(</span><span class="tok-k">const</span> <span class="tok-n">BopData</span> <span class="tok-o">*</span><span class="tok-n">d</span><span class="tok-p">,</span> <span class="tok-kt">int</span> <span class="tok-o">*</span><span class="tok-n">n</span><span class="tok-p">);</span>           <i class="conum" data-value="2"></i><b>(2)</b>
<span class="tok-n">BopStatus</span> <span class="tok-nf">bop_get_vars</span><span class="tok-p">(</span><span class="tok-k">const</span> <span class="tok-n">BopData</span> <span class="tok-o">*</span><span class="tok-n">d</span><span class="tok-p">,</span> <span class="tok-n">Cbuf</span> <span class="tok-o">*</span><span class="tok-n">vars</span><span class="tok-p">);</span>        <i class="conum" data-value="3"></i><b>(3)</b>
<span class="tok-n">BopStatus</span> <span class="tok-nf">bop_get_vars</span><span class="tok-p">(</span><span class="tok-k">const</span> <span class="tok-n">BopData</span> <span class="tok-o">*</span><span class="tok-n">d</span><span class="tok-p">,</span> <span class="tok-k">const</span> <span class="tok-kt">char</span> <span class="tok-o">**</span><span class="tok-n">vars</span><span class="tok-p">);</span> <i class="conum" data-value="4"></i><b>(4)</b>
<span class="tok-n">BopStatus</span> <span class="tok-nf">bop_get_type</span><span class="tok-p">(</span><span class="tok-k">const</span> <span class="tok-n">BopData</span> <span class="tok-o">*</span><span class="tok-n">d</span><span class="tok-p">,</span> <span class="tok-n">BopType</span> <span class="tok-o">*</span><span class="tok-n">type</span><span class="tok-p">);</span>     <i class="conum" data-value="5"></i><b>(5)</b>
<span class="tok-k">const</span> <span class="tok-kt">void</span><span class="tok-o">*</span> <span class="tok-nf">bop_get_data</span><span class="tok-p">(</span><span class="tok-k">const</span> <span class="tok-n">BopData</span> <span class="tok-o">*</span><span class="tok-n">d</span><span class="tok-p">);</span>                  <i class="conum" data-value="6"></i><b>(6)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>get the number of particles</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>get the number of fields</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>get the variable names in <code>Cbuf</code> array</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>get variable names in <code>const char**</code> format</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>get the type of the data</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>get a pointer on the internal buffer (read only)</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_error_handling">1.4. Error handling</h3>
<div class="paragraph">
<p>Any function from the library returns an error status encoded in the
<code>BopStatus</code> type.
The status can be interpreted by calling the functions:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span></span><span class="tok-kt">bool</span>         <span class="tok-nf">bop_success</span><span class="tok-p">(</span><span class="tok-n">BopStatus</span> <span class="tok-n">status</span><span class="tok-p">);</span>           <i class="conum" data-value="1"></i><b>(1)</b>
<span class="tok-k">const</span> <span class="tok-kt">char</span> <span class="tok-o">*</span> <span class="tok-nf">bop_report_error_desc</span><span class="tok-p">(</span><span class="tok-n">BopStatus</span> <span class="tok-n">status</span><span class="tok-p">);</span> <i class="conum" data-value="2"></i><b>(2)</b>
<span class="tok-kt">char</span> <span class="tok-o">*</span>       <span class="tok-nf">bop_report_error_mesg</span><span class="tok-p">();</span>                 <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>returns <code>true</code> on success and <code>false</code> if an error occured</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>returns a description of the status</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>report additional informations on the error</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_convenient_tools">1.5. Convenient tools</h3>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span></span><span class="tok-n">BopStatus</span> <span class="tok-nf">bop_summary</span><span class="tok-p">(</span><span class="tok-k">const</span> <span class="tok-n">BopData</span> <span class="tok-o">*</span><span class="tok-n">d</span><span class="tok-p">);</span>                                    <i class="conum" data-value="1"></i><b>(1)</b>
<span class="tok-n">BopStatus</span> <span class="tok-nf">bop_concatenate</span><span class="tok-p">(</span><span class="tok-k">const</span> <span class="tok-kt">int</span> <span class="tok-n">nd</span><span class="tok-p">,</span> <span class="tok-k">const</span> <span class="tok-n">BopData</span> <span class="tok-o">**</span><span class="tok-n">dd</span><span class="tok-p">,</span> <span class="tok-n">BopData</span> <span class="tok-o">*</span><span class="tok-n">dall</span><span class="tok-p">);</span> <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>output summary in stdout stream</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>cancatenate <code>nd</code> <code>BopData</code> structures into one</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_serial_interface">2. serial interface</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Interface specific to sequential version</p>
</div>
<div class="sect2">
<h3 id="_write">2.1. write</h3>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span></span><span class="tok-n">BopStatus</span> <span class="tok-nf">bop_write_header</span><span class="tok-p">(</span><span class="tok-k">const</span> <span class="tok-kt">char</span> <span class="tok-o">*</span><span class="tok-n">name</span><span class="tok-p">,</span> <span class="tok-k">const</span> <span class="tok-n">BopData</span> <span class="tok-o">*</span><span class="tok-n">d</span><span class="tok-p">);</span> <i class="conum" data-value="1"></i><b>(1)</b>
<span class="tok-n">BopStatus</span> <span class="tok-nf">bop_write_values</span><span class="tok-p">(</span><span class="tok-k">const</span> <span class="tok-kt">char</span> <span class="tok-o">*</span><span class="tok-n">name</span><span class="tok-p">,</span> <span class="tok-k">const</span> <span class="tok-n">BopData</span> <span class="tok-o">*</span><span class="tok-n">d</span><span class="tok-p">);</span> <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>write the header file from <code>BopData</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>write the data file from <code>BopData</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Note that <code>name</code> is the basename of the file, without the extension.
This results in the header file <code>name.bop</code> and int the data file <code>name.values</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_read">2.2. read</h3>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span></span><span class="tok-n">BopStatus</span> <span class="tok-nf">bop_read_header</span><span class="tok-p">(</span><span class="tok-k">const</span> <span class="tok-kt">char</span> <span class="tok-o">*</span><span class="tok-n">hfname</span><span class="tok-p">,</span> <span class="tok-n">BopData</span> <span class="tok-o">*</span><span class="tok-n">d</span><span class="tok-p">,</span> <span class="tok-kt">char</span> <span class="tok-o">*</span><span class="tok-n">dfname</span><span class="tok-p">);</span> <i class="conum" data-value="1"></i><b>(1)</b>
<span class="tok-n">BopStatus</span> <span class="tok-nf">bop_read_values</span><span class="tok-p">(</span><span class="tok-k">const</span> <span class="tok-kt">char</span> <span class="tok-o">*</span><span class="tok-n">dfname</span><span class="tok-p">,</span> <span class="tok-n">BopData</span> <span class="tok-o">*</span><span class="tok-n">d</span><span class="tok-p">);</span>               <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>read and parse the header file. returns the name of the data file
in the (user provided) buffer <code>dfname</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>read data file and store it inside the internal buffer of the
<code>BopData</code> structure</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_mpi_interface">3. mpi interface</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Interface specific to mpi version</p>
</div>
<div class="sect2">
<h3 id="_write_2">3.1. write</h3>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span></span><span class="tok-n">BopStatus</span> <span class="tok-nf">bop_write_header</span><span class="tok-p">(</span><span class="tok-n">MPI_Comm</span> <span class="tok-n">comm</span><span class="tok-p">,</span> <span class="tok-k">const</span> <span class="tok-kt">char</span> <span class="tok-o">*</span><span class="tok-n">name</span><span class="tok-p">,</span> <span class="tok-k">const</span> <span class="tok-n">BopData</span> <span class="tok-o">*</span><span class="tok-n">d</span><span class="tok-p">);</span> <i class="conum" data-value="1"></i><b>(1)</b>
<span class="tok-n">BopStatus</span> <span class="tok-nf">bop_write_values</span><span class="tok-p">(</span><span class="tok-n">MPI_Comm</span> <span class="tok-n">comm</span><span class="tok-p">,</span> <span class="tok-k">const</span> <span class="tok-kt">char</span> <span class="tok-o">*</span><span class="tok-n">name</span><span class="tok-p">,</span> <span class="tok-k">const</span> <span class="tok-n">BopData</span> <span class="tok-o">*</span><span class="tok-n">d</span><span class="tok-p">);</span> <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>write the header file from <code>BopData</code>. Must be called by all ranks
of the communicator <code>comm</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>write the data file from <code>BopData</code>. Must be called by all ranks
of the communicator <code>comm</code>.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Note that <code>name</code> is the basename of the file, without the extension.
This results in the header file <code>name.bop</code> and int the data file <code>name.values</code>.</p>
</div>
<div class="paragraph">
<p>The header file will contain the total number of particles, it is reduced internally.</p>
</div>
</div>
<div class="sect2">
<h3 id="_read_2">3.2. read</h3>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span></span><span class="tok-n">BopStatus</span> <span class="tok-nf">bop_read_header</span><span class="tok-p">(</span><span class="tok-n">MPI_Comm</span> <span class="tok-n">comm</span><span class="tok-p">,</span> <span class="tok-k">const</span> <span class="tok-kt">char</span> <span class="tok-o">*</span><span class="tok-n">hfname</span><span class="tok-p">,</span> <span class="tok-n">BopData</span> <span class="tok-o">*</span><span class="tok-n">d</span><span class="tok-p">,</span> <span class="tok-kt">char</span> <span class="tok-o">*</span><span class="tok-n">dfname</span><span class="tok-p">);</span>  <i class="conum" data-value="1"></i><b>(1)</b>
<span class="tok-n">BopStatus</span> <span class="tok-nf">bop_read_values</span><span class="tok-p">(</span><span class="tok-n">MPI_Comm</span> <span class="tok-n">comm</span><span class="tok-p">,</span> <span class="tok-k">const</span> <span class="tok-kt">char</span> <span class="tok-o">*</span><span class="tok-n">dfname</span><span class="tok-p">,</span> <span class="tok-n">BopData</span> <span class="tok-o">*</span><span class="tok-n">d</span><span class="tok-p">);</span>                <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>read and parse the header file. returns the name of the data file
in the (user provided) buffer <code>dfname</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>read data file and store it inside the internal buffer of the
<code>BopData</code> structure. This is a collective operation.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Note: The collective read for ascii values is not supported.
The user must use the serial implementation.</p>
</div>
</div>
</div>
</div>
</div>
</body>
</html>